stages:
  - test
  - package

test-python:
  stage: test
  image: python:3.6
  script:
    - pip3 install -r requirements.txt
    - ./hollow.py -h
  tags:
    - runner:k8s

package-docker:
  stage: package
  image: docker:stable
  services:
    - docker:stable-dind
  before_script:
    - mkdir /root/.docker
    - ln -s /secrets/docker /root/.docker/config.json
    - docker info
  script:
    - docker build -t ssube/hollow-yaml .
    - docker push ssube/hollow-yaml
  variables:
    DOCKER_HOST: tcp://localhost:2375
  tags:
    - runner:k8s
